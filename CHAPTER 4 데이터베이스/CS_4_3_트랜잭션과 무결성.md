# 💻 CS Study 4.3 트랜잭션과 무결성

> `면접을 위한 CS 전공지식 노트` **4.3 트랜잭션과 무결성**
>
> `4.3.1 트랜잭션`
>
> `4.3.2 무결성`
>
<br>

--- 
<br>

## **1. 트랜잭션**
<br>

> 데이터베이스에서 하나의 논리적 기능을 수행하기 위한 작업의 단위
>
> 여러 개의 쿼리들을 하나로 묶는 단위
>
<br>

### 트랜잭션의 특징 : **ACID**

<br>

    원자성, 일관성, 독립성, 지속성

<br>

### **원자성 (Atomicity)**
<br>

> 트랜잭션과 관련된 일이 **모두 수행되거나 되지 않았거나**를 보장 
>
> `All` 혹은 `Nothing` 
> 

<br>

### **일관성 (Consistency)**
<br>

> **허용된 방식으로만 데이터를 변경**해야 하는 것을 의미 
>

<br>

### **독립성 (Isolation)**
<br>

> 트랜잭션 수행 시 서로 **끼어들지 못하는 것**을 의미 
>
<br>

### 트랜잭션 격리 수준
<br>

> 동시에 여러 트랜잭션이 처리될 때, **트랜잭션끼리 얼마나 서로 고립되어 있는지**를 나타냄
>
> 동시성을 증가시키면 데이터 무결성에 문제가 발생하고 데이터 무결성을 유지하면 동시성을 떨어짐
>
> 레벨을 높게 조정할수록 고립 정도가 높아지나, 성능은 떨어지며, 발생 비용이 증가
>
> 일반적인 온라인 서비스에서 `오라클은 Read committed`를 사용, `MySQL은 Repeatable read`를 사용
>

<br>

![트랜잭션](https://3553248446-files.gitbook.io/~/files/v0/b/gitbook-legacy-files/o/assets%2F-M5HOStxvx-Jr0fqZhyW%2F-MGdOhx8aWkOCeHcri8Q%2F-MGdW-V-iOgKgGmSOVd7%2F%E1%84%80%E1%85%B3%E1%84%85%E1%85%B5%E1%86%B71.png?alt=media&token=0722018a-0d24-4586-9288-d9c306d2c263)

<br>

### Read Uncommitted (Level 0)
<br>

>  트랜잭션에 처리중이거나 아직 커밋되지 않은 데이터를 **다른 트랜잭션이 읽는 것을 허용**
>
> 데이터베이스의 **일관성을 유지하는 것이 불가능**
>
<br>

### Read committed (Level 1)
<br>

>  트랜잭션이 수행되는 동안 **다른 트랜잭션이 접근할 수 없어 대기**해야 함
>
> **커밋이 이루어진 트랜잭션만 조회 가능**
>
> 기본으로 사용하는 고립 수준
<br>

### Repeatable Read (Level 2)
<br>

> 트랜잭션 범위 내에서 조회한 데이터 내용이 **항상 동일함**을 보장
>
> 다른 사용자는 트랜잭션 영역에 해당되는 **데이터 수정 불가능**
>
<br>

### Serializable (Level 3)
<br>

>  가장 엄격한 격리 수준으로 **완벽한 읽기 일관성 모드를 제공**
>
> 다른 사용자는 **트랜잭션 영역에 해당되는 데이터에 대한 수정 및 입력 불가**
>
<br>

### 낮은 단계 고립 수준을 활용할 때 발생하는 현상들

<br>

1. Dirty Read
<br>

    -   어떤 트랜잭션에서 아직 실행이 끝나지 않은 변경사항을 다른 트랜잭션에서 보게되는 경우 

    -   커밋되지 않고 수정중인 데이터를 다른 트랜잭션에서 읽을 수 있도록 허용할 때 발생

2. Non-Repeatable Read
<br>

    -   한 트랜잭션에서 같은 쿼리를 두 번 수행할 때 그 사이에 다른 트랜잭션 **값을 수정 또는 삭제**하면서 두 쿼리의 **결과가 상이**하게 나타나, **일관성이 깨지는** 현상 

    -   한 트랜잭션에서 똑같은 SELECT문을 수행했을 때 **항상 같은 결과를 반환**해야 한다는 **Repeatable Read 정합성에 어긋남**

3. Phantom Read
<br>

    -   한 트랜잭션 안에서 일정 범위의 레코드를 두 번 이상 읽었을 때, **첫 번째 쿼리에서 없던 레코드가 두 번째 쿼리에서 나타나**는 현상

    -   트랜잭션 도중 **새로운 레코드 삽입을 허용**하기 때문에 나타나는 현상

### **지속성 (Durability)**
<br>

> 성공적으로 수행된 트랜잭션은 **영원히 반영**되어야 함 
>
> 데이터베이스에 시스템 장애가 발생해도 **원래 상태로 복구하는 회복 기능**이 있어야 함
>
> `체크섬`, `저널링`, `롤백` 기능 제공 

<br>

### 용어 정리

<br>

1. 체크섬
    -   중복 검사의 한 형태로, 오류 정정을 통해 송신된 자료의 무결성을 보호

2. 저널링
    -   파일 시스템 또는 데이터베이스 시스템에 변경 사항을 커밋하기 전에 로깅하는 것
    -   트랜잭션 등 변경 사항에 대한 로그를 남기는 것

3. 롤백
    -   트랜잭션으로 처리한 하나의 묶음 과정을 일어나기 전으로 돌리는 일 (취소)

<br>

## **2. 무결성**
<br>

> 데이터의 **정확성, 일관성, 유효성을 유지**하는 것을 의미
>
> 무결성이 유지되어야 데이터베이스에 저장된 값과 그 값에 해당하는 현실 세계의 실제 값이 일치하는지 신뢰가 생김
>

<br>

### 무결성 종류

<br>

1. 개체 무결성
    -   기본키로 선택된 필드는 **빈 값(NULL)이나 중복된 값**을 허용하지 않음

2. 참조 무결성
    -   서로 참조 관계에 있는 두 테이블의 데이터는 **항상 일관된 값**을 유지
    -   외래키 값은 NULL이거나 참조하는 릴레이션의 기본키 값과 동일해야 함

3. 고유 무결성
    -   특정 속성에 대해 고유한 값을 가지도록 조건이 주어진 경우, 그 속성 값은 모두 고유한 값을 가짐
    -   속성 값들은 서로 달라야 함

4. NULL 무결성
    -   특정 속성 값에 NULL이 올 수 없다는 조건이 주어진 경우, 그 속성 값은 NULL이 될 수 없음

5. 도메인 무결성
    -   속성들의 값은 정의된 도메인에 속한 값이어야 함

5. 키 무결성
    - 각 릴레이션은 최소한 한 개 이상의 키가 존재해야 함